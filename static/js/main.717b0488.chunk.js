(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{109:function(e,t,n){},111:function(e,t,n){},113:function(e,t,n){},117:function(e,t,n){},119:function(e,t,n){},121:function(e,t,n){},123:function(e,t,n){"use strict";n.r(t);n(70);var a=n(0),r=n.n(a),o=n(67),i=n.n(o),s=(n(109),n(3)),c=n(4),u=n(6),l=n(5),d=n(7),p=(n(111),n(9)),h=n(68),g=(n(113),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).initState=function(){return{isDragged:!1}},n.state=Object(h.a)({},n.initState(),{prevIndex:null}),n.waypointRef=r.a.createRef(),n.buttonRef=r.a.createRef(),n.rafID=null,n.isPointerSupported=Boolean(window.PointerEvent),n.scrollingElement=document.scrollingElement||document.documentElement,n._isMounted=!1,n.updateBaseRect=function(){var e=n.waypointRef.current.getBoundingClientRect(),t={top:e.top+n.scrollingElement.scrollTop,bottom:e.bottom+n.scrollingElement.scrollTop,left:e.left+n.scrollingElement.scrollLeft,right:e.right+n.scrollingElement.scrollLeft};n.props.setWaypointDocCoord(n.props.index,t)},n.handleButtonClick=function(e){e.preventDefault(),e.stopPropagation(),window.cancelAnimationFrame(n.rafID),n.props.handleDelete(n.props.state.id)},n.updateDraggedState=function(e){n.setState({isDragged:!0},function(){return n.props.setDragged(n.props.index)})},n.handleGestureStart=function(e){e.preventDefault(),e.touches&&e.touches.length>1||n.updateDraggedState()},n.handleGesture=n.isPointerSupported?{onPointerDown:n.handleGestureStart}:{onMouseDown:n.handleGestureStart},n.handleButtonDown=n.isPointerSupported?{onPointerDown:n.handleButtonClick}:{onMouseDown:n.handleButtonClick},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.buttonRef.current.addEventListener("touchstart",this.handleButtonClick,!0),this.isPointerSupported||this.waypointRef.current.addEventListener("touchstart",this.handleGestureStart,!0),this.updateBaseRect()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"componentDidUpdate",value:function(e){this.state.prevIndex===this.props.index||this.state.isDragged||(this.updateBaseRect(),this.setState({prevIndex:this.props.index})),!this.props.isDragging&&this.props.isDragging!==e.isDragging&&this.state.isDragged&&this.setState({isDragged:!1})}},{key:"render",value:function(){var e="route-waypoint__draggable"+(this.state.isDragged?" route-waypoint__draggable_dragging":"");return r.a.createElement("div",{className:"route-waypoint "+this.props.className},r.a.createElement("div",Object.assign({},this.handleGesture,{className:e,style:this.props.state.style,ref:this.waypointRef}),r.a.createElement("div",{className:"route-waypoint__name"},this.props.state.name),r.a.createElement("button",Object.assign({type:"button",className:"route-waypoint__button",ref:this.buttonRef},this.handleButtonDown))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return null===t.prevIndex?{prevIndex:e.index}:null}}]),t}(r.a.Component)),m=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).state={text:""},n.inputRef=r.a.createRef(),n.handleChange=function(e){n.setState({text:e.target.value})},n.handleKeyDown=function(e){"Enter"===e.key&&!e.repeat&&e.target.value.trim()&&(n.props.handleEnter(e.target.value),n.setState({text:""}))},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.isMapLoaded&&this.inputRef.current.focus()}},{key:"componentDidUpdate",value:function(e){e.isMapLoaded!==this.props.isMapLoaded&&this.inputRef.current.focus()}},{key:"render",value:function(){return r.a.createElement("div",{className:this.props.className},r.a.createElement("input",{type:"text",placeholder:this.props.placeholder,autoComplete:"off",autoCorrect:"off",onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:this.state.text,ref:this.inputRef,disabled:!this.props.isMapLoaded}))}}]),t}(r.a.Component),f=n(1),v=n.n(f),y=n(14),w=function(e){return function(){var t=Object(y.a)(v.a.mark(function t(n){var a;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n;case 3:if(a=t.sent,e.value){t.next=6;break}throw Object({type:"CANCELED"});case 6:return t.abrupt("return",a);case 9:throw t.prev=9,t.t0=t.catch(0),e.value?t.t0:{type:"CANCELED"};case 12:case"end":return t.stop()}},t,this,[[0,9]])}));return function(e){return t.apply(this,arguments)}}()},b=(n(117),n(119),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"centering-outer",style:{height:this.props.height}},r.a.createElement("div",{className:"centering-middle"},this.props.children))}}]),t}(r.a.Component)),k=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).state={isLoading:!0,error:null,markers:[],map:null,polyline:null,lastAction:null},n.isPolylineAnimating=!1,n._isMounted={value:!1},n.isGoogleApiLoaded="google"in window,n.isGeolocationSupported="geolocation"in navigator,n.googleMapRef=r.a.createRef(),n.googleMapApiKey="AIzaSyC3BmUjtcRlGyF4IXIuW0daNjoSFjDnRxA",n.markerColors={start:"http://maps.google.com/mapfiles/ms/icons/green-dot.png",default:"http://maps.google.com/mapfiles/ms/icons/yellow-dot.png",end:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"},n.addMarker=function(e){var t,a=n.state.markers.length;return a?(t=n.markerColors.end,1!==a&&n.state.markers[a-1].marker.setIcon(n.markerColors.default)):t=n.markerColors.start,new window.google.maps.Marker({position:e,map:n.state.map,draggable:!0,icon:t})},n.reverseGeocode=function(){var e=Object(y.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new window.google.maps.Geocoder,e.next=4,new Promise(function(e,a){n.geocode({location:t},function(t,n){"OK"===n?e(t[0]):a(n)})});case 4:return e.abrupt("return",e.sent);case 7:e.prev=7,e.t0=e.catch(0),console.error("reverse geocode error caught",e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),n.updatePolyline=function(e){if(n.state.polyline&&n.state.polyline.setMap(null),e.length>1){var t=e.map(function(e){return e.marker.getPosition().toJSON()}),a=new window.google.maps.Polyline({path:t,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});return a.setMap(n.state.map),a}return null},n.dragPolylineAnimation=function(){n.isPolylineAnimating&&n._isMounted&&n.setState(function(e){return{polyline:n.updatePolyline(e.markers),lastAction:"POLYLINE"}},function(){return n.isPolylineAnimating=!1})},n.getLocation=Object(y.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise(function(e,t){navigator.geolocation.getCurrentPosition(function(t){return e(t)},function(){return t(Error("geolocation blocked"))})});case 3:return t=e.sent,e.abrupt("return",t);case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}},e,this,[[0,7]])})),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getDefaultCenter",value:function(){return{lat:55.7558,lng:37.6173}}},{key:"updateMarkerIcon",value:function(e,t){0===t?e[t].marker.setIcon(this.markerColors.start):t===e.length-1?e[t].marker.setIcon(this.markerColors.end):t<e.length-1&&e[t].marker.setIcon(this.markerColors.default)}},{key:"componentDidMount",value:function(){var e=Object(y.a)(v.a.mark(function e(){var t,n,a,r,o,i,s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isMounted.value=!0,this.withCancel=w(this._isMounted),e.prev=2,this.isGoogleApiLoaded){e.next=7;break}return e.next=6,this.withCancel(this.getGoogleApi());case 6:this.isGoogleApiLoaded=!0;case 7:if(!this.isGeolocationSupported){e.next=20;break}return e.prev=8,e.next=11,this.withCancel(this.getLocation());case 11:n=e.sent,a=n.coords,r=a.latitude,o=a.longitude,t={lat:r,lng:o},e.next=20;break;case 18:e.prev=18,e.t0=e.catch(8);case 20:t||(t=this.getDefaultCenter()),i={center:t,zoom:8},s=new window.google.maps.Map(this.googleMapRef.current,i),this.setState({map:s}),this.props.onMapLoad(),e.next=32;break;case 27:if(e.prev=27,e.t1=e.catch(2),"CANCELED"!==e.t1.type){e.next=31;break}return e.abrupt("return");case 31:this.setState({error:e.t1});case 32:return e.prev=32,this.setState({isLoading:!1}),e.finish(32);case 35:case"end":return e.stop()}},e,this,[[2,27,32,35],[8,18]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this._isMounted.value=!1}},{key:"componentDidUpdate",value:function(e,t){var n,a=this,r=this.props.payload,o=r.id,i=r.action,s=r.name,c=r.newIndex,u=e.payload.id,l=null;if("ADD"===i&&o!==u){var d=this.state.map.getCenter().toJSON(),h=this.addMarker(d);h.addListener("drag",function(){a.isPolylineAnimating=!0,window.requestAnimationFrame(a.dragPolylineAnimation)});var g=new window.google.maps.InfoWindow;h.addListener("click",Object(y.a)(v.a.mark(function e(){var t,n,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.getPosition().toJSON(),e.next=3,a.reverseGeocode(t);case 3:n=e.sent,r='\n        <div class="route-map__popup">\n          <div class="route-map__popup__name">'.concat(s,"</div>\n          ").concat(n?'<div class="route-map__popup__address">'.concat(n.formatted_address,"</div>"):"","\n        </div>"),g.setContent(r),g.open(a.state.map,h);case 7:case"end":return e.stop()}},e,this)}))),l=Object(p.a)(this.state.markers).concat([{id:o,marker:h}])}else if("DELETE"===i&&t.markers.length===this.state.markers.length){var m=this.state.markers.findIndex(function(e){return e.id===o});if(-1===m)return;this.state.markers[m].marker.setMap(null),m===(l=Object(p.a)(this.state.markers.slice(0,m)).concat(Object(p.a)(this.state.markers.slice(m+1)))).length&&0!==l.length?this.updateMarkerIcon(l,l.length-1):m||0===l.length||this.updateMarkerIcon(l,0)}else if("MOVE"===i&&this.state.markers[c].id!==o){var f=this.state.markers.findIndex(function(e){return e.id===o}),w=(l=Object(p.a)(this.state.markers)).splice(f,1)[0];l.splice(c,0,w);for(var b=Math.min(f,c);b<=Math.max(f,c);b++)this.updateMarkerIcon(l,b)}(l&&l.length!==this.state.markers.length||"MOVE"===i&&this.state.markers[c].id!==o)&&(n=this.updatePolyline(l),this.setState({markers:l,polyline:n,lastAction:i})),"POLYLINE"===this.state.lastAction&&this.setState({lastAction:null})}},{key:"getGoogleApi",value:function(){var e=Object(y.a)(v.a.mark(function e(){var t=this;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise(function(e,n){var a=document.createElement("script"),r=t.googleMapApiKey;a.src="https://maps.googleapis.com/maps/api/js?key=".concat(r),a.type="text/javascript",a.async=!1,a.onload=function(t){return e("google api loaded")},a.onerror=function(e){return n(new Error(e))},document.body.appendChild(a)});case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.isLoading||this.state.error?{display:"none"}:{display:"block"};return r.a.createElement("div",{className:"route-map "+this.props.className},this.state.isLoading&&r.a.createElement(b,null,r.a.createElement("div",{className:"route-map__loading"},"Loading")),this.state.error&&r.a.createElement(b,null,r.a.createElement("div",{className:"route-map__error"},this.state.error.message)),r.a.createElement("div",{className:"route-map__map",style:e,ref:this.googleMapRef}))}}]),t}(r.a.Component),D=(n(121),function(e){if(!e)return{x:0,y:0};var t=e.match(/-?\d+(\.\d+)?/g);return{x:+t[0],y:+t[1]}}),x=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).state={isMaxWaypointsReached:!1,isMapLoaded:!1,waypoints:[],id:0,draggedIndex:null,mapPayload:{id:null,newIndex:null,action:"",name:""},isDragAnimating:!1,isDragStarted:!1,canDragStart:!1},n.startTouchCoord=null,n.isPointerSupported=Boolean(window.PointerEvent),n.waypointsRef=r.a.createRef(),n.handleEnter=function(e){n.setState(function(t){return 15===t.waypoints.length?{isMaxWaypointsReached:!0}:{waypoints:Object(p.a)(t.waypoints).concat([{name:e,id:t.id,style:{transform:"",WebkitTransform:"",msTransform:""}}]),id:t.id+1,mapPayload:{id:t.id,action:"ADD",name:e}}})},n.handleDelete=function(e){n.setState(function(t){return{waypoints:t.waypoints.filter(function(t){return t.id!==e}),isMaxWaypointsReached:!1,mapPayload:{id:e,action:"DELETE"}}})},n.setWaypointDocCoord=function(e,t){var a=Object(p.a)(n.state.waypoints);a[e].baseRect=t,n.setState({waypoints:a})},n.findDraggedOn=function(e,t){n.state.waypoints.every(function(a,r){if(a.id===n.state.waypoints[n.state.draggedIndex].id)return!0;var o=(a.baseRect.top+a.baseRect.bottom)/2;return!(o<=Math.max(e.y,t.y)&&o>=Math.min(e.y,t.y)&&a.baseRect.left<=t.x&&a.baseRect.right>=t.x)||(n.handleMove(r),!1)})},n.setDragged=function(e){n.setState({canDragStart:!0,draggedIndex:e,mapPayload:{action:""}})},n.handleMove=function(e){n.setState(function(t){var a=Object(p.a)(t.waypoints),r=t.draggedIndex,o=a[r].baseRect.top,i=a[e].baseRect.top-o;n.startTouchCoord={x:n.startTouchCoord.x,y:n.startTouchCoord.y+i};var s=D(a[r].style.transform).x,c="translate(".concat(s,"px, ",0,"px)");a[t.draggedIndex].style={transform:c,WebkitTransform:c,msTransform:c};var u=t.waypoints[r].id;a[r].baseRect=a[e].baseRect;var l=a.splice(r,1)[0];return a.splice(e,0,l),window.cancelAnimationFrame(n.rafID),{isDragAnimating:!1,draggedIndex:e,waypoints:a,mapPayload:{id:u,newIndex:e,action:"MOVE"}}})},n.handleMapLoad=function(){return n.setState({isMapLoaded:!0})},n.getCurrentPageCoordinates=function(e){return e.touches&&e.changedTouches[0]?{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY}:{x:e.pageX,y:e.pageY}},n.dragAnimating=function(e){var t=e.x,a=e.y;n._isMounted&&n.state.isDragAnimating&&n.setState(function(e){var n=Object(p.a)(e.waypoints),r="translate(".concat(t,"px, ").concat(a,"px)");return n[e.draggedIndex].style={transform:r,WebkitTransform:r,msTransform:r},{waypoints:n}},function(){n.setState({isDragAnimating:!1})})},n.handleGestureStart=function(e){e.preventDefault(),e.touches&&e.touches.length>1||(n.isPointerSupported?e.currentTarget.setPointerCapture(e.pointerId):(document.addEventListener("mousemove",n.handleGestureMove,!0),document.addEventListener("mouseup",n.handleGestureEnd,!0)),n.startTouchCoord=n.getCurrentPageCoordinates(e),n.currPointerCoord=n.startTouchCoord,n.setState({isDragStarted:!0}))},n.handleGestureMove=function(e){if(n.state.canDragStart&&(e.preventDefault(),n.state.isDragStarted&&!n.state.isDragAnimating)){n.setState({isDragAnimating:!0}),n.prevPointerCoord=n.currPointerCoord,n.currPointerCoord=n.getCurrentPageCoordinates(e);var t={x:n.currPointerCoord.x-n.startTouchCoord.x,y:n.currPointerCoord.y-n.startTouchCoord.y};n.findDraggedOn(n.prevPointerCoord,n.currPointerCoord),n.rafID=window.requestAnimationFrame(function(){return n.dragAnimating(t)})}},n.handleGestureEnd=function(e){e.preventDefault(),e.touches&&e.touches.length>0||(n.isPointerSupported?e.currentTarget.releasePointerCapture(e.pointerId):(document.removeEventListener("mousemove",n.handleGestureMove,!0),document.removeEventListener("mouseup",n.handleGestureEnd,!0)),n.setState(function(e){var t=Object(p.a)(e.waypoints);return t[e.draggedIndex]&&(t[e.draggedIndex].style={transform:"",WebkitTransform:"",msTransform:""}),{newWaypoints:t,draggedIndex:null,isDragStarted:!1,canDragStart:!1,isDragAnimating:!1}}),n.rafID=null)},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.handleGesture=this.isPointerSupported?{onPointerDown:this.handleGestureStart,onPointerMove:this.handleGestureMove,onPointerUp:this.handleGestureEnd,onPointerCancel:this.handleGestureEnd}:{onMouseDown:this.handleGestureStart,onTouchMove:this.handleGestureMove,onTouchEnd:this.handleGestureEnd},this.isPointerSupported||this.waypointsRef.current.addEventListener("touchstart",this.handleGestureStart)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this,t=this.state.waypoints.map(function(t,n){return r.a.createElement(g,{key:t.id.toString(),index:n,state:t,className:"map-route-creation__waypoint",handleDelete:e.handleDelete,setDragged:e.setDragged,draggedIndex:e.state.draggedIndex,isDragging:e.state.isDragStarted,setWaypointDocCoord:e.setWaypointDocCoord,findDraggedOn:e.findDraggedOn})}),n="map-route-creation__waypoints "+(this.state.isDragStarted?"map-route-creation__waypoints_dragging":"");return r.a.createElement(b,{height:"100vh"},r.a.createElement("div",{className:"map-route-creation",ref:this.mapRouteRef},r.a.createElement("div",{className:"map-route-creation__content"},r.a.createElement(m,{className:"map-route-creation__input",handleEnter:this.handleEnter,placeholder:"\u041d\u043e\u0432\u0430\u044f \u0442\u043e\u0447\u043a\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430",isMapLoaded:this.state.isMapLoaded}),r.a.createElement("div",Object.assign({className:n},this.handleGesture,{ref:this.waypointsRef}),t),this.state.isMaxWaypointsReached&&r.a.createElement("div",{className:"map-route-creation__warning"},"15 \u0442\u043e\u0447\u0435\u043a \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c")),r.a.createElement(k,{className:"map-route-creation__map",payload:this.state.mapPayload,onMapLoad:this.handleMapLoad})))}}]),t}(r.a.Component),E=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(x,null))}}]),t}(a.Component);i.a.render(r.a.createElement(E,null),document.getElementById("root"))},69:function(e,t,n){e.exports=n(123)}},[[69,2,1]]]);
//# sourceMappingURL=main.717b0488.chunk.js.map